<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Exercise: Simulating evolution using Lande’s equation | Introduction to evolutionary and coevolutionary theory</title>
  <meta name="description" content="This is the webpage for the course “Introduction to evolutionary and coevolutionary theory”. Here you will find the course schedule, as well as all of the lecture notes." />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Exercise: Simulating evolution using Lande’s equation | Introduction to evolutionary and coevolutionary theory" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is the webpage for the course “Introduction to evolutionary and coevolutionary theory”. Here you will find the course schedule, as well as all of the lecture notes." />
  <meta name="github-repo" content="lgcosmo/evo_coevo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Exercise: Simulating evolution using Lande’s equation | Introduction to evolutionary and coevolutionary theory" />
  
  <meta name="twitter:description" content="This is the webpage for the course “Introduction to evolutionary and coevolutionary theory”. Here you will find the course schedule, as well as all of the lecture notes." />
  

<meta name="author" content="Leandro G. Cosmo" />


<meta name="date" content="2024-07-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exercise-simulating-evolution-using-the-price-theorem.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Course notes</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#registration"><i class="fa fa-check"></i><b>1.1</b> Registration</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#course-schedule"><i class="fa fa-check"></i><b>1.2</b> Course schedule</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#bibliography"><i class="fa fa-check"></i><b>1.3</b> Bibliography</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-the-course.html"><a href="introduction-to-the-course.html"><i class="fa fa-check"></i><b>2</b> Introduction to the course</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-the-course.html"><a href="introduction-to-the-course.html#the-fundamental-concepts-of-evolution-by-natural-selection"><i class="fa fa-check"></i><b>2.1</b> The fundamental concepts of evolution by natural selection</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-the-course.html"><a href="introduction-to-the-course.html#natural-selection-and-the-evolution-of-allele-frequencies-within-populations"><i class="fa fa-check"></i><b>2.2</b> Natural selection and the evolution of allele frequencies within populations</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="introduction-to-the-course.html"><a href="introduction-to-the-course.html#building-our-first-equation"><i class="fa fa-check"></i><b>2.2.1</b> Building our first equation</a></li>
<li class="chapter" data-level="2.2.2" data-path="introduction-to-the-course.html"><a href="introduction-to-the-course.html#wrights-equation-for-the-adaptive-landscape-of-alleles"><i class="fa fa-check"></i><b>2.2.2</b> Wright’s equation for the adaptive landscape of alleles</a></li>
<li class="chapter" data-level="2.2.3" data-path="introduction-to-the-course.html"><a href="introduction-to-the-course.html#references"><i class="fa fa-check"></i><b>2.2.3</b> References</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="exercise-evolution-of-allele-frequencies.html"><a href="exercise-evolution-of-allele-frequencies.html"><i class="fa fa-check"></i><b>3</b> Exercise: Evolution of allele frequencies</a>
<ul>
<li class="chapter" data-level="3.1" data-path="exercise-evolution-of-allele-frequencies.html"><a href="exercise-evolution-of-allele-frequencies.html#simulating-evolutionary-changes-in-allele-frequencies"><i class="fa fa-check"></i><b>3.1</b> Simulating evolutionary changes in allele frequencies</a></li>
<li class="chapter" data-level="3.2" data-path="exercise-evolution-of-allele-frequencies.html"><a href="exercise-evolution-of-allele-frequencies.html#using-different-assumptions-for-the-fitness-of-alleles-a-and-b"><i class="fa fa-check"></i><b>3.2</b> Using different assumptions for the fitness of alleles A and B</a></li>
<li class="chapter" data-level="3.3" data-path="exercise-evolution-of-allele-frequencies.html"><a href="exercise-evolution-of-allele-frequencies.html#simulating-wrights-adaptive-landscape"><i class="fa fa-check"></i><b>3.3</b> Simulating Wright’s adaptive landscape</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exercise-simulating-evolution-using-the-price-theorem.html"><a href="exercise-simulating-evolution-using-the-price-theorem.html"><i class="fa fa-check"></i><b>4</b> Exercise: Simulating evolution using the Price theorem</a>
<ul>
<li class="chapter" data-level="4.1" data-path="exercise-simulating-evolution-using-the-price-theorem.html"><a href="exercise-simulating-evolution-using-the-price-theorem.html#simulating-evolutionary-changes-in-allele-frequencies-1"><i class="fa fa-check"></i><b>4.1</b> Simulating evolutionary changes in allele frequencies</a></li>
<li class="chapter" data-level="4.2" data-path="exercise-simulating-evolution-using-the-price-theorem.html"><a href="exercise-simulating-evolution-using-the-price-theorem.html#the-regression-of-fitness-on-phenotypes-and-the-modes-of-selection"><i class="fa fa-check"></i><b>4.2</b> The regression of fitness on phenotypes and the modes of selection</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="exercise-simulating-evolution-using-landes-equation.html"><a href="exercise-simulating-evolution-using-landes-equation.html"><i class="fa fa-check"></i><b>5</b> Exercise: Simulating evolution using Lande’s equation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="exercise-simulating-evolution-using-landes-equation.html"><a href="exercise-simulating-evolution-using-landes-equation.html#simulating-evolutionary-changes-in-continuous-traits"><i class="fa fa-check"></i><b>5.1</b> Simulating evolutionary changes in continuous traits</a></li>
<li class="chapter" data-level="5.2" data-path="exercise-simulating-evolution-using-landes-equation.html"><a href="exercise-simulating-evolution-using-landes-equation.html#simulating-the-adaptive-landscape-of-a-continuous-trait"><i class="fa fa-check"></i><b>5.2</b> Simulating the adaptive landscape of a continuous trait</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to evolutionary and coevolutionary theory</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exercise-simulating-evolution-using-landes-equation" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Exercise: Simulating evolution using Lande’s equation<a href="exercise-simulating-evolution-using-landes-equation.html#exercise-simulating-evolution-using-landes-equation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="simulating-evolutionary-changes-in-continuous-traits" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Simulating evolutionary changes in continuous traits<a href="exercise-simulating-evolution-using-landes-equation.html#simulating-evolutionary-changes-in-continuous-traits" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Our third lecture introduced the classical equation in quantitative genetics derived by <a href="https://onlinelibrary.wiley.com/doi/10.1111/j.1558-5646.1976.tb00911.x">Russel Lande (1976)</a>. After studying and going through the steps to derive this equation, here we will use it to simulate evolutionary changes in continuously varying traits. Lande’s equation relates how the mean value of a continuous trait in a population (<span class="math inline">\(\overline{z}\)</span>) changes from one generation to the other in response to the available variance of the trait in the population (<span class="math inline">\(\sigma^{2}_{z}\)</span>), its heritability, <span class="math inline">\(h^2\)</span>, and direction and intensity of natural selection. The direction and intensity of selection on the trait is mathematically described by the selection gradient, <span class="math inline">\(\frac{\partial ln\overline{W}}{\partial \overline{z}}\)</span>. These two components underly Lande’s equation and can be used to predict evolutionary changes in <span class="math inline">\(\overline{z}\)</span> as follows:</p>
<p><span class="math display">\[
\Delta \overline{z}=h^2 \sigma^{2}_{z}\frac{\partial ln\overline{W}}{\partial \overline{z}}
\]</span></p>
<p>There are two main approaches that we can use to model evolutionary changes using Lande’s equation. For the first one, our starting point is a function describing how the fitness of individuals vary with trait values. We next use this function to derive a new one, describing how the mean fitness of the population depends on the mean values of traits. Finally, we derive the selection gradient which can then, be plugged in into Lande’s equation. The second approach is directly assuming a function for the selection gradient. Here, we will use the first approach, but we will also see how to use the second one in block 2 of the course.</p>
<p>Thus, our first step is to define a function, <span class="math inline">\(W(z)\)</span>, describing how fitness of individuals vary with trait values. We will use the two fitness functions that are similar to the ones used in the previous exercise section, as follows:</p>
<p><span class="math display">\[\begin{align}
W_{1}(z) &amp;= 1+\beta z \\
W_{2}(z) &amp;= e^{-\alpha\left(\theta-z\right)^2}
\end{align}\]</span></p>
<p>We now need to derive how mean fitness changes relative to mean trait values. To do so, we need to compute the expected value of the fitness function of individuals. For linear functions of random variable, such as <span class="math inline">\(W_{1}(z)\)</span>, computing an expected value is straightforward because of two identities: <span class="math inline">\(E[aX]=aE[X]\)</span> and <span class="math inline">\(E[X+b]=E[X]+b\)</span>. For our function <span class="math inline">\(W_{1}(z)\)</span>, we can apply these two identities as follows:</p>
<p><span class="math display">\[
E[1+\beta z] = 1+E[\beta z]=1+\beta E[z]=1+\beta \overline{z}
\]</span> where we used the equivalence <span class="math inline">\(E[z]=\overline{z}\)</span> just to simplify the notation. For the second fitness function, <span class="math inline">\(W_{2}(z)\)</span>, we need to rely on an approximation to compute the expected value. When <span class="math inline">\(z\)</span> is normally distributed (as it needs to be when applying Lande’s equation), with small values of <span class="math inline">\(\alpha\)</span> or variance, <span class="math inline">\(\sigma^2\)</span>, we can approximate this expectation as follows:</p>
<p><span class="math display">\[
E[e^{-\alpha\left(\theta-z\right)^2}] \approx e^{-\alpha\left[\left(\theta-\overline{z}\right)^2 + \sigma^2\right]}
\]</span></p>
<p>We will not cover the approximation in the course, but it comes from how we can approximate <span class="math inline">\(E[ln f(X)]\)</span> as <span class="math inline">\(lnE[f(X)]\)</span> under the assumptions mentioned above (<a href="https://pubmed.ncbi.nlm.nih.gov/3744046/">Barton 1986</a>).</p>
<p>Our last step is to derive the selection gradient. For that we need to apply the natural logarithm to the functions above and compute their derivatives relative to the mean trait value. Computing derivatives is very straightforward when you are familiar with all of the rules. If you are not familiar with computing derivatives, we can do it using the function D() in R. To use this R function, we just need to define an expression and the variable that we wish to compute the derivative in that expression. The code to do so for the fitness function <span class="math inline">\(\overline{W}_{1}(\overline{z})\)</span> is as follows:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="exercise-simulating-evolution-using-landes-equation.html#cb17-1" tabindex="-1"></a>dw1<span class="ot">=</span><span class="fu">D</span>(<span class="fu">expression</span>(<span class="fu">log</span>(<span class="dv">1</span><span class="sc">+</span>beta<span class="sc">*</span>z)), <span class="st">&quot;z&quot;</span>)</span>
<span id="cb17-2"><a href="exercise-simulating-evolution-using-landes-equation.html#cb17-2" tabindex="-1"></a><span class="fu">print</span>(dw1)</span></code></pre></div>
<pre><code>## beta/(1 + beta * z)</code></pre>
<p>As you can see, the derivative is equal to <span class="math inline">\(\frac{\beta}{1+\beta \overline{z}}\)</span>. We can repeat the same process for second fitness function, <span class="math inline">\(e^{-\alpha\left[\left(\theta-\overline{z}\right)^2 + \sigma^2\right]}\)</span>. Since we are computing the derivative of the natural logarithm of this function, we can simplify it as <span class="math inline">\(lnW_{2}(\overline{z})=-\alpha\left[\left(\theta-\overline{z}\right)^2 + \sigma^2\right]\)</span> and use the simplified function to compute the derivative, as follows:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="exercise-simulating-evolution-using-landes-equation.html#cb19-1" tabindex="-1"></a>dw2<span class="ot">=</span><span class="fu">D</span>(<span class="fu">expression</span>(<span class="sc">-</span>a<span class="sc">*</span>((theta<span class="sc">-</span>z)<span class="sc">^</span><span class="dv">2</span><span class="sc">+</span>v)), <span class="st">&quot;z&quot;</span>) <span class="co">#v here corresponds to the variance in the equation</span></span>
<span id="cb19-2"><a href="exercise-simulating-evolution-using-landes-equation.html#cb19-2" tabindex="-1"></a><span class="fu">print</span>(dw2)</span></code></pre></div>
<pre><code>## a * (2 * (theta - z))</code></pre>
<p>which evaluates to <span class="math inline">\(2\alpha (\theta-\overline{z})\)</span>. Now we have everything that we need to model how the mean value of the trait, <span class="math inline">\(\overline{z}\)</span>, changes over generations in the population. We will begin with how <span class="math inline">\(\overline{z}\)</span> changes when we use the first fitness function. Plugging the selection gradient that we computed above for this fitness function in Lande’s equation, the equation that we need to iterate over is the following one:</p>
<p><span class="math display">\[
\overline{z}^{(t+1)}=\overline{z}^{(t)}+ h^2 \sigma^{2}_{z}\frac{\beta}{1+\beta \overline{z}^{(t)}}
\]</span></p>
<p>Thus, as we did in the first exercise section, we need to define:</p>
<ol style="list-style-type: decimal">
<li>A vector that will store trait values over time.</li>
<li>The initial trait value in the population.</li>
<li>The parameters of the model, such as the number of generations that we will simulate, <span class="math inline">\(t_{max}\)</span>, <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\sigma^{2}_{z}\)</span> and <span class="math inline">\(h^2\)</span>.</li>
</ol>
<p>Then, after defining all of the parameters we iterate over the equation using a for loop. The code to perform these steps are as follows:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-1" tabindex="-1"></a>dz <span class="ot">=</span> <span class="fu">c</span>() <span class="co">#Defining vector to store trait values over time</span></span>
<span id="cb21-2"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-2" tabindex="-1"></a>z0 <span class="ot">=</span> <span class="dv">1</span> <span class="co">#Defining initial trait value in the population</span></span>
<span id="cb21-3"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-3" tabindex="-1"></a>dz[<span class="dv">1</span>] <span class="ot">=</span> z0 <span class="co">#Defining initial trait value in the population</span></span>
<span id="cb21-4"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-4" tabindex="-1"></a></span>
<span id="cb21-5"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-5" tabindex="-1"></a>tmax<span class="ot">=</span><span class="dv">100</span> <span class="co"># Number of generations</span></span>
<span id="cb21-6"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-6" tabindex="-1"></a>varz<span class="ot">=</span><span class="fl">0.1</span> <span class="co"># Phenotypic variance</span></span>
<span id="cb21-7"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-7" tabindex="-1"></a>h <span class="ot">=</span> <span class="fl">0.1</span> <span class="co"># Heritability</span></span>
<span id="cb21-8"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-8" tabindex="-1"></a>beta<span class="ot">=</span><span class="fl">0.5</span> <span class="co">#Parameter beta</span></span>
<span id="cb21-9"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-9" tabindex="-1"></a></span>
<span id="cb21-10"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-10" tabindex="-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(tmax<span class="dv">-1</span>)){ <span class="co">#Setting up the for loop</span></span>
<span id="cb21-11"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-11" tabindex="-1"></a>  </span>
<span id="cb21-12"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-12" tabindex="-1"></a>  z <span class="ot">=</span> dz[t] <span class="co"># Setting current trait values</span></span>
<span id="cb21-13"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-13" tabindex="-1"></a>  dlnw <span class="ot">=</span> (beta<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>beta<span class="sc">*</span>z))  <span class="co">#Computing the selection gradient of fitness function 1</span></span>
<span id="cb21-14"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-14" tabindex="-1"></a>  dz[t<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span> z <span class="sc">+</span> h<span class="sc">*</span>varz<span class="sc">*</span>dlnw <span class="co">#Updating trait values using Lande&#39;s equation</span></span>
<span id="cb21-15"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-15" tabindex="-1"></a>  </span>
<span id="cb21-16"><a href="exercise-simulating-evolution-using-landes-equation.html#cb21-16" tabindex="-1"></a>}</span></code></pre></div>
<p>Now, as we did before, we can put the above code inside a function to make it easier to explore the simulations and plot the results.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb22-2"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-2" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb22-3"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-3" tabindex="-1"></a></span>
<span id="cb22-4"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-4" tabindex="-1"></a>evo_simulation<span class="ot">&lt;-</span><span class="cf">function</span>(tmax, z0, varz, h, beta){</span>
<span id="cb22-5"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-5" tabindex="-1"></a></span>
<span id="cb22-6"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-6" tabindex="-1"></a>dz <span class="ot">=</span> <span class="fu">c</span>() <span class="co">#Defining vector to store trait values over time</span></span>
<span id="cb22-7"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-7" tabindex="-1"></a>dz[<span class="dv">1</span>] <span class="ot">=</span> z0 <span class="co">#Defining initial trait value in the population</span></span>
<span id="cb22-8"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-8" tabindex="-1"></a></span>
<span id="cb22-9"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-9" tabindex="-1"></a><span class="cf">for</span>(t <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(tmax<span class="dv">-1</span>)){ <span class="co">#Setting up the for loop</span></span>
<span id="cb22-10"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-10" tabindex="-1"></a>  </span>
<span id="cb22-11"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-11" tabindex="-1"></a>  z <span class="ot">=</span> dz[t] <span class="co"># Setting current trait values</span></span>
<span id="cb22-12"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-12" tabindex="-1"></a>  dlnw <span class="ot">=</span> (beta<span class="sc">/</span>(<span class="dv">1</span><span class="sc">+</span>beta<span class="sc">*</span>z))  <span class="co">#Computing the selection gradient of fitness function 1</span></span>
<span id="cb22-13"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-13" tabindex="-1"></a>  dz[t<span class="sc">+</span><span class="dv">1</span>]<span class="ot">=</span> z <span class="sc">+</span> h<span class="sc">*</span>varz<span class="sc">*</span>dlnw <span class="co">#Updating trait values using Lande&#39;s equation</span></span>
<span id="cb22-14"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-14" tabindex="-1"></a>  </span>
<span id="cb22-15"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-15" tabindex="-1"></a>}</span>
<span id="cb22-16"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-16" tabindex="-1"></a></span>
<span id="cb22-17"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-17" tabindex="-1"></a>r <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">dz=</span>dz, <span class="at">t=</span><span class="dv">1</span><span class="sc">:</span>tmax) <span class="co"># Building the data frame with trait values over time</span></span>
<span id="cb22-18"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-18" tabindex="-1"></a>  </span>
<span id="cb22-19"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-19" tabindex="-1"></a><span class="fu">return</span>(r)</span>
<span id="cb22-20"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-20" tabindex="-1"></a></span>
<span id="cb22-21"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-21" tabindex="-1"></a>}</span>
<span id="cb22-22"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-22" tabindex="-1"></a></span>
<span id="cb22-23"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-23" tabindex="-1"></a><span class="co"># Running the function to test it:</span></span>
<span id="cb22-24"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-24" tabindex="-1"></a></span>
<span id="cb22-25"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-25" tabindex="-1"></a>r <span class="ot">=</span> <span class="fu">evo_simulation</span>(<span class="at">tmax=</span><span class="dv">100</span>, <span class="at">z0=</span><span class="dv">1</span>, <span class="at">h=</span><span class="fl">0.1</span>, <span class="at">varz=</span><span class="fl">0.1</span>, <span class="at">beta=</span><span class="fl">0.5</span>)</span>
<span id="cb22-26"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-26" tabindex="-1"></a></span>
<span id="cb22-27"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-27" tabindex="-1"></a><span class="co"># Plotting the result</span></span>
<span id="cb22-28"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-28" tabindex="-1"></a></span>
<span id="cb22-29"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-29" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb22-30"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-30" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>r, <span class="fu">aes</span>(<span class="at">x=</span>t, <span class="at">y=</span>dz))<span class="sc">+</span></span>
<span id="cb22-31"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-31" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Generation&quot;</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Average trait value in the population&quot;</span>)<span class="sc">+</span></span>
<span id="cb22-32"><a href="exercise-simulating-evolution-using-landes-equation.html#cb22-32" tabindex="-1"></a>  <span class="fu">theme_pubr</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-17-1.png" width="65%" height="65%" /></p>
<p>Using the function above, explore how different parameter values change the outcome of the evolutionary dynamics. Try to think about why we have this outcome in face of the fitness function that we are using.</p>
</div>
<div id="simulating-the-adaptive-landscape-of-a-continuous-trait" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Simulating the adaptive landscape of a continuous trait<a href="exercise-simulating-evolution-using-landes-equation.html#simulating-the-adaptive-landscape-of-a-continuous-trait" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Before proceeding to the second fitness function, we can gain more intuition about the outcome of the evolutionary dynamics when we visualize the fitness landscape of the trait. To do so, we will repeat a similar procedure to what we have already done in the first exercise section. We will go through the following steps:</p>
<ol style="list-style-type: decimal">
<li><p>Build a vector containing many different values of <span class="math inline">\(\overline{z}\)</span>.</p></li>
<li><p>Compute the average fitness of the population, <span class="math inline">\(\overline{W}\)</span>, for each of these values of <span class="math inline">\(\overline{z}\)</span> using the fitness function.</p></li>
<li><p>Plot and visualize the fitness landscape.</p></li>
</ol>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="exercise-simulating-evolution-using-landes-equation.html#cb23-1" tabindex="-1"></a>beta<span class="ot">=</span><span class="fl">0.5</span> <span class="co">#Defining parameter beta</span></span>
<span id="cb23-2"><a href="exercise-simulating-evolution-using-landes-equation.html#cb23-2" tabindex="-1"></a>z <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="fl">0.001</span>) <span class="co"># Step 1</span></span>
<span id="cb23-3"><a href="exercise-simulating-evolution-using-landes-equation.html#cb23-3" tabindex="-1"></a>w_avg <span class="ot">=</span> <span class="dv">1</span><span class="sc">+</span>beta<span class="sc">*</span>z <span class="co">#Step 2</span></span>
<span id="cb23-4"><a href="exercise-simulating-evolution-using-landes-equation.html#cb23-4" tabindex="-1"></a></span>
<span id="cb23-5"><a href="exercise-simulating-evolution-using-landes-equation.html#cb23-5" tabindex="-1"></a>land <span class="ot">=</span> <span class="fu">data.frame</span>(z, w_avg) <span class="co">#Building a data frame with values of p and the corresponding average fitness</span></span>
<span id="cb23-6"><a href="exercise-simulating-evolution-using-landes-equation.html#cb23-6" tabindex="-1"></a></span>
<span id="cb23-7"><a href="exercise-simulating-evolution-using-landes-equation.html#cb23-7" tabindex="-1"></a><span class="co"># Plotting the landscape.</span></span>
<span id="cb23-8"><a href="exercise-simulating-evolution-using-landes-equation.html#cb23-8" tabindex="-1"></a></span>
<span id="cb23-9"><a href="exercise-simulating-evolution-using-landes-equation.html#cb23-9" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb23-10"><a href="exercise-simulating-evolution-using-landes-equation.html#cb23-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>land, <span class="fu">aes</span>(<span class="at">x=</span>z, <span class="at">y=</span>w_avg))<span class="sc">+</span></span>
<span id="cb23-11"><a href="exercise-simulating-evolution-using-landes-equation.html#cb23-11" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Average trait value in the population&quot;</span>)<span class="sc">+</span><span class="fu">ylab</span>(<span class="st">&quot;Average fitness of the population&quot;</span>)<span class="sc">+</span></span>
<span id="cb23-12"><a href="exercise-simulating-evolution-using-landes-equation.html#cb23-12" tabindex="-1"></a>  <span class="fu">theme_pubr</span>()</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-18-1.png" width="65%" height="65%" /></p>
<p>Now that we have the adaptive landscape, try to think about its shape and how evolution proceeds when we use the first fitness function. Your task for this section will be to adapt the code to simulate the evolutionary dynamics and the fitness landscape when we use the second fitness function, <span class="math inline">\(e^{-\alpha\left[\left(\theta-\overline{z}\right)^2 + \sigma^2\right]}\)</span>. Use both the function and the selection gradient, <span class="math inline">\(2\alpha (\theta-\overline{z})\)</span>, to simulate the adaptive landscape and the evolutionary dynamics of the trait. Try to answer the following questions:</p>
<ol style="list-style-type: decimal">
<li><p>For both fitness functions, is there and end point to the evolutionary dynamics? If it does so, what would be this end point?</p></li>
<li><p>From the shape of the adaptive landscapes, could you predict how evolution would proceed in the population?</p></li>
<li><p>What sources of selective pressures and biological mechanisms could lead to these two adaptive landscapes and their underlying evolutionary dynamics?</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exercise-simulating-evolution-using-the-price-theorem.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-ex3.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
